<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Leg Day — Front Squat Builder</title>
<style>
  :root{
    --pad:14px; --radius:16px;
    --bg:#0b0d13; --panel:#121725; --line:#23283a;
    --text:#eaf0ff; --muted:#9aa6bd; --brand:#5b8cff; --accent:#35e0b9;
  }
  *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  body{
    margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    background: radial-gradient(1200px 800px at 80% -10%, #122044 0%, #0c101a 40%, #0b0d13 100%);
    color:var(--text); line-height:1.45;
    padding-bottom:126px; /* sticky footer space */
  }
  header{
    position:sticky; top:0; z-index:10;
    background:linear-gradient(180deg, rgba(10,14,24,.9), rgba(10,14,24,.4) 60%, transparent);
    backdrop-filter: blur(4px);
    padding:20px var(--pad) 8px; border-bottom:1px solid #121526;
  }
  h1{margin:0 0 6px 0; font-size:20px; letter-spacing:.2px}
  .sub{color:var(--muted); font-size:13px}

  .card{
    background:linear-gradient(180deg, #141a2d 0%, #0f1423 100%);
    border:1px solid #1f2742; border-radius:var(--radius);
    padding:16px; margin:14px; box-shadow: 0 10px 30px rgba(0,0,0,.25);
  }
  .section-title{font-weight:800; letter-spacing:.2px; margin:4px 14px 8px; color:#cfe0ff; font-size:15px}
  .row{display:flex; gap:10px; flex-wrap:wrap}
  .row > *{flex:1 1 140px}
  label{display:block; font-size:12px; color:#aab7d0; margin-bottom:6px}
  input, select{
    width:100%; padding:12px; border-radius:12px; border:1px solid #26304e;
    background:#0c1122; color:#eff3ff; font-size:16px;
    box-shadow: inset 0 0 0 1px rgba(255,255,255,.02);
  }
  input[type="range"]{padding:0; background:transparent}
  input[type="number"]{appearance:textfield}
  input::placeholder{color:#6f7c93}
  .btn{
    display:inline-block; width:100%; text-align:center; padding:14px 16px;
    border-radius:14px; border:1px solid #2b3557; background:#152044; color:#fff;
    font-weight:700; font-size:16px; letter-spacing:.2px;
    box-shadow: 0 6px 16px rgba(19,33,62,.35);
  }
  .btn.primary{background:linear-gradient(180deg,#4a78ff,#2a55ee); border-color:#3854c9}
  .btn.ghost{background:transparent}
  .btn:active{transform:scale(.995)}
  .btn-row{display:flex; gap:10px; margin-top:8px}

  table{width:100%; border-collapse:separate; border-spacing:0 10px}
  td,th{padding:10px 12px; text-align:left; font-size:14px}
  thead th{color:#cfe0ff; font-weight:700}
  tbody tr{background:#0f1530; border:1px solid #20305b; border-radius:12px}
  tbody tr td:first-child, thead tr th:first-child{border-radius:12px 0 0 12px}
  tbody tr td:last-child, thead tr th:last-child{border-radius:0 12px 12px 0}
  .mono{font-family: ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
  .pill{
    display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px;
    background:linear-gradient(180deg,#13223f,#0e1a33); border:1px solid #1f2f57; font-size:12px; color:#d8e4ff;
  }
  .hint{color:#93a2bf; font-size:13px; margin-top:8px}

  .plan{margin:8px 14px}
  .step{
    display:flex; align-items:center; gap:12px; padding:12px; border-radius:16px;
    border:1px solid #223154; margin-bottom:10px; background:linear-gradient(180deg,#121a34,#0d1327);
    box-shadow: 0 10px 20px rgba(0,0,0,.25);
  }
  .step.active{border-color:#54a0ff; background:linear-gradient(180deg,#121c3f,#0c1229);
               box-shadow: 0 12px 30px rgba(26,92,255,.18); }
  .rightTime{margin-left:auto; font-weight:800}

  /* STICKY FOOTER */
  footer{
    position:fixed; left:0; right:0; bottom:0; z-index:30;
    background: linear-gradient(180deg, rgba(18,26,49,.65), rgba(10,14,26,.9));
    backdrop-filter: blur(10px);
    border-top:1px solid #233152;
    padding:10px var(--pad) 12px;
    box-shadow: 0 -10px 30px rgba(0,0,0,.35);
  }
  .footerRow{
    display:flex; align-items:center; gap:12px;
  }
  .now{flex:1; min-width:0}
  .now strong{display:block; font-size:14px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
  .now small{display:block; color:var(--muted); font-size:12px}
  .sets{color:#cfe0ff; font-size:12px; margin-top:4px}
  .timer{
    min-width:108px; text-align:center; font-weight:900; font-size:22px; letter-spacing:.5px;
    padding:10px 12px; border-radius:14px; background:linear-gradient(180deg,#0f1530,#0a0f26);
    border:1px solid #213059; box-shadow: inset 0 -12px 30px rgba(91,140,255,.15);
  }
  .controls{display:flex; gap:8px}
  .controls .btn{width:auto; padding:10px 12px; font-size:14px}

  .scrubWrap{margin-top:8px; display:flex; align-items:center; gap:10px}
  .scrubWrap output{min-width:3ch; text-align:right; color:#b7c7e6}
  input[type="range"].scrub{
    width:100%;
    -webkit-appearance:none; height:10px; border-radius:999px; background:#0c1226; border:1px solid #1e2c4f;
    box-shadow: inset 0 6px 20px rgba(65,115,255,.18);
  }
  input[type="range"].scrub::-webkit-slider-thumb{
    -webkit-appearance:none; width:22px; height:22px; border-radius:50%;
    background: radial-gradient(circle at 30% 30%, #fff, #b8d0ff);
    border:1px solid #6a93ff; box-shadow: 0 6px 16px rgba(81,132,255,.6);
    margin-top:-6px;
  }
</style>
</head>
<body>
<header>
  <h1>Leg Day • Front Squat Builder</h1>
  <div class="sub">Warmup (knee-friendly) → 4×6 Front Squats @ 70–75% → RDL / Step-Ups / Bridges</div>
</header>

<!-- TOTAL TIME SLIDER -->
<div class="card">
  <div class="section-title">Total Workout Time</div>
  <div class="row" style="align-items:center">
    <div class="row" style="flex:2 1 220px; align-items:center">
      <input id="totalTime" type="range" min="20" max="45" step="1" value="30" />
      <output id="totalTimeOut" class="mono" style="margin-left:8px">30</output><span class="hint">min</span>
    </div>
    <div style="flex:1 1 140px">
      <label for="focusMode">Focus Mode</label>
      <select id="focusMode"><option value="off">Off</option><option value="on">On</option></select>
    </div>
  </div>
  <div class="hint">This sets the overall session length. All blocks scale proportionally.</div>
</div>

<!-- SETTINGS -->
<div class="card" id="settings">
  <div class="section-title">Inputs</div>
  <div class="row">
    <div>
      <label for="units">Units</label>
      <select id="units">
        <option value="lb">Pounds (lb)</option>
        <option value="kg">Kilograms (kg)</option>
      </select>
    </div>
    <div>
      <label for="barWeight">Bar Weight</label>
      <input id="barWeight" type="number" step="1" placeholder="45 (lb) / 20 (kg)" />
    </div>
    <div>
      <label for="oneRM">Front Squat 1RM / Training Max</label>
      <input id="oneRM" type="number" step="1" placeholder="Enter your 1RM or TM" />
    </div>
  </div>
  <div class="row">
    <div>
      <label for="fsLow">Front Squat % (Set 1–2)</label>
      <input id="fsLow" type="number" step="1" value="70" />
    </div>
    <div>
      <label for="fsHigh">Front Squat % (Set 3–4)</label>
      <input id="fsHigh" type="number" step="1" value="75" />
    </div>
    <div>
      <label for="roundTo">Round to nearest</label>
      <input id="roundTo" type="number" step="0.5" value="5" />
      <div class="hint">Use 2.5 for kg plates</div>
    </div>
  </div>
  <div class="row">
    <div>
      <label for="rdlPct">RDL % of Front Squat 1RM</label>
      <input id="rdlPct" type="number" step="1" value="55" />
    </div>
    <div>
      <label for="stepPct">Step-Ups % of Front Squat 1RM (pair total)</label>
      <input id="stepPct" type="number" step="1" value="30" />
    </div>
    <div>
      <label for="bridgePct">Glute Bridge % of Front Squat 1RM</label>
      <input id="bridgePct" type="number" step="1" value="60" />
    </div>
  </div>
  <div class="btn-row">
    <button class="btn" id="save">Save Inputs</button>
    <button class="btn ghost" id="clear">Clear</button>
    <button class="btn primary" id="calc">Calculate Weights</button>
  </div>
</div>

<!-- TARGETS -->
<div class="card" id="targets">
  <div class="section-title">Front Squat Targets (4×6 • 3s down, fast up)</div>
  <table>
    <thead><tr><th>Set</th><th>%</th><th>Target (Total)</th><th>Plates/Side</th><th>Notes</th></tr></thead>
    <tbody id="fsTable"></tbody>
  </table>
</div>

<div class="card" id="accessories">
  <div class="section-title">Accessory Suggestions</div>
  <table>
    <thead><tr><th>Exercise</th><th>Sets×Reps</th><th>Suggested Load</th><th>Notes</th></tr></thead>
    <tbody id="accTable"></tbody>
  </table>
</div>

<!-- FLOW -->
<div class="section-title">Guided Flow</div>
<div class="plan" id="plan"></div>

<footer>
  <div class="footerRow">
    <div class="pill" id="nowTag">Ready</div>
    <div class="now">
      <strong id="nowStep">Press Start</strong>
      <small id="nowSubtitle">Warmup begins at 00:00</small>
      <div class="sets" id="nowSets">Sets/Reps: —</div>
    </div>
    <div class="timer mono" id="clock">30:00</div>
    <div class="controls">
      <button class="btn primary" id="startBtn">Start</button>
      <button class="btn" id="pauseBtn">Pause</button>
      <button class="btn ghost" id="resetBtn">Reset</button>
    </div>
  </div>
  <div class="scrubWrap">
    <output id="scrubOut" class="mono">00:00</output>
    <input class="scrub" id="scrubber" type="range" min="0" max="1800" step="1" value="0" />
    <output id="scrubMax" class="mono">30:00</output>
  </div>
</footer>

<script>
  const $ = s => document.querySelector(s);

  // ---------- Inputs ----------
  const inputs = {
    units: $('#units'), bar: $('#barWeight'), oneRM: $('#oneRM'),
    fsLow: $('#fsLow'), fsHigh: $('#fsHigh'), roundTo: $('#roundTo'),
    rdlPct: $('#rdlPct'), stepPct: $('#stepPct'), bridgePct: $('#bridgePct')
  };

  // ---------- Base Plan (30:00 = 1800s) ----------
  const baseSteps = [
    // Warmup (600s)
    {id:'w1', tag:'Warmup', name:'Foam Roll Quads & Glutes', dur:60,  note:'30s each side'},
    {id:'w2', tag:'Warmup', name:'Leg Swings',               dur:60,  note:'20 F/B + 20 S/S each leg'},
    {id:'w3', tag:'Warmup', name:'Glute Bridges',            dur:60,  note:'2×15 (bodyweight)'},
    {id:'w4', tag:'Warmup', name:'Walking Lunges',           dur:120, note:'2×12 each (short stride)'},
    {id:'w5', tag:'Warmup', name:'Banded Lateral Walks',     dur:120, note:'2×10 steps each direction'},
    {id:'w6', tag:'Warmup', name:'Goblet Squat Hold',        dur:180, note:'30s hold × 2, pry hips open'},

    // Squat block (900s)
    {id:'s0', tag:'Front Squat', name:'Setup & Bracing',     dur:120, note:'Rack height; elbows tall'},
    {id:'s1', tag:'Front Squat', name:'Front Squat — Set 1', dur:75,  note:'6 reps @ Set 1 %'},
    {id:'r1', tag:'Rest',        name:'Rest',                dur:150, note:'Breathe; elbows high next set'},
    {id:'s2', tag:'Front Squat', name:'Front Squat — Set 2', dur:75,  note:'6 reps @ Set 1 %'},
    {id:'r2', tag:'Rest',        name:'Rest',                dur:150, note:'Brace hard; knees track out'},
    {id:'s3', tag:'Front Squat', name:'Front Squat — Set 3', dur:75,  note:'6 reps @ Set 3 %'},
    {id:'r3', tag:'Rest',        name:'Rest',                dur:150, note:'Stay upright; heels down'},
    {id:'s4', tag:'Front Squat', name:'Front Squat — Set 4', dur:75,  note:'6 reps @ Set 3 %'},
    {id:'sx', tag:'Front Squat', name:'Reset & Notes',       dur:30,  note:'Log weight, loosen wrists'},

    // Accessories (300s)
    {id:'a1', tag:'Accessories', name:'Accessories',         dur:300, note:'Pick 2—RDL / Step-Ups / Bridges'},
  ];

  function baseTotal(){ return baseSteps.reduce((s,x)=>s+x.dur,0); }

  let steps = JSON.parse(JSON.stringify(baseSteps));
  const planEl = $('#plan');

  // ---------- Scaling (Total Time Slider) ----------
  function scaleToTotal(minutes){
    const target = minutes*60, base = baseTotal(), scale = target/base;
    let sum=0;
    steps = baseSteps.map(st=>{
      const scaled = Math.max(20, Math.round(st.dur*scale));
      sum += scaled; return {...st, dur:scaled};
    });
    steps[steps.length-1].dur += (target - sum); // fix rounding
    $('#scrubber').max = target;
    $('#scrubMax').textContent = fmt(target);
    renderPlan(); reset();
  }

  // ---------- Weight Math ----------
  function unitsSymbol(){ return inputs.units.value==='kg' ? 'kg' : 'lb'; }
  function roundToNearest(value, step){ const s = Number(step||5); return Math.round(value/s)*s; }
  function plateMath(total, bar, step){
    const perSide = (total - bar)/2; if(perSide<=0) return '—';
    const p = roundToNearest(perSide, step); return `${p}${unitsSymbol()}`;
  }
  function calcFSWeights(){
    const rm = Number(inputs.oneRM.value||0), bar = Number(inputs.bar.value||0), r = Number(inputs.roundTo.value||5);
    const low = Number(inputs.fsLow.value||70)/100, high = Number(inputs.fsHigh.value||75)/100;
    if (rm<=0 || bar<=0) return [];
    const s1 = roundToNearest(rm*low, r), s2 = s1, s3 = roundToNearest(rm*high, r), s4 = s3;
    return [
      {set:1, pct:Math.round(low*100)+'%', total:s1, plates:plateMath(s1,bar,r)},
      {set:2, pct:Math.round(low*100)+'%', total:s2, plates:plateMath(s2,bar,r)},
      {set:3, pct:Math.round(high*100)+'%', total:s3, plates:plateMath(s3,bar,r)},
      {set:4, pct:Math.round(high*100)+'%', total:s4, plates:plateMath(s4,bar,r)},
    ];
  }
  function calcAccessories(){
    const rm = Number(inputs.oneRM.value||0), r = Number(inputs.roundTo.value||5), bar = Number(inputs.bar.value||0);
    if (rm<=0) return [];
    const rdl = roundToNearest(rm*(Number(inputs.rdlPct.value||55)/100), r);
    const stepPair = roundToNearest(rm*(Number(inputs.stepPct.value||30)/100), r);
    const bridge = roundToNearest(rm*(Number(inputs.bridgePct.value||60)/100), r);
    const stepEach = unitsSymbol()==='kg' ? Math.round((stepPair/2)*10)/10 : roundToNearest(stepPair/2, r);
    return [
      {name:'Romanian Deadlift (RDL)', scheme:'3×10', load:`${rdl}${unitsSymbol()}`, notes:'Barbell or dumbbells'},
      {name:'Weighted Step-Ups', scheme:'2×10/leg', load:`${stepEach}${unitsSymbol()} each hand`, notes:'Box ~ knee height'},
      {name:'Barbell Glute Bridge', scheme:'3×12', load:`${bridge}${unitsSymbol()}`, notes:`Plates/side: ${plateMath(bridge,bar,r)}`}
    ];
  }
  function renderTables(){
    const fsData = calcFSWeights();
    const fsT = $('#fsTable'); fsT.innerHTML='';
    if(!fsData.length){
      fsT.innerHTML = `<tr><td colspan="5" class="hint">Enter your 1RM/TM and tap <b>Calculate Weights</b>.</td></tr>`;
    } else {
      fsData.forEach(row=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>Set ${row.set}</td>
          <td><span class="pill">${row.pct}</span></td>
          <td class="mono">${row.total} ${unitsSymbol()}</td>
          <td class="mono">${row.plates}</td>
          <td>${row.set<=2?'Depth + bracing':'Elbows high, stay tall'}</td>`;
        fsT.appendChild(tr);
      });
    }
    const acc = calcAccessories();
    const accT = $('#accTable'); accT.innerHTML='';
    if(!acc.length){
      accT.innerHTML = `<tr><td colspan="4" class="hint">Enter your 1RM/TM to get suggested loads.</td></tr>`;
    } else {
      acc.forEach(a=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${a.name}</td><td>${a.scheme}</td><td class="mono">${a.load}</td><td>${a.notes}</td>`;
        accT.appendChild(tr);
      });
    }
  }

  // ---------- Plan / Render ----------
  function fmt(s){ const m=Math.floor(s/60),sec=s%60; return `${String(m).padStart(2,'0')}:${String(sec).padStart(2,'0')}`; }
  function planTotal(){ return steps.reduce((s,x)=>s+x.dur,0); }

  function renderPlan(){
    planEl.innerHTML='';
    const fsW = calcFSWeights();
    steps.forEach(st=>{
      const row = document.createElement('div'); row.className='step';
      const pctHint = (id)=>{
        if(id==='s1'||id==='s2') return fsW.length?`${fsW[0].total} ${unitsSymbol()}`:'~70% 1RM';
        if(id==='s3'||id==='s4') return fsW.length?`${fsW[2].total} ${unitsSymbol()}`:'~75% 1RM';
        return null;
      };
      const add = pctHint(st.id);
      row.innerHTML = `
        <div class="pill">${st.tag}</div>
        <div style="flex:1">
          <div style="font-weight:800">${st.name}${add?` • <span class="mono">${add}</span>`:''}</div>
          <small style="color:#9fb0d1">${st.note||''}</small>
        </div>
        <div class="rightTime mono">${fmt(st.dur)}</div>`;
      planEl.appendChild(row);
    });
    highlight();
    updateClock();
  }

  // ---------- Timer + Footer Slider ----------
  let idx=0, remain=0, ticking=false, handle=null;

  function elapsed(){ return planTotal() - remain; }
  function setElapsed(newElapsed){
    // Clamp 0..total, recompute step index and remaining
    const total = planTotal();
    const e = Math.max(0, Math.min(newElapsed, total));
    remain = total - e;
    // find step for e
    let acc=0, newIdx=0;
    for(let i=0;i<steps.length;i++){ acc += steps[i].dur; if(e < acc){ newIdx = i; break; } }
    idx = newIdx;
    highlight(); updateClock(); updateFooterSetInfo();
  }

  function highlight(){
    document.querySelectorAll('.step').forEach((el,i)=> el.classList.toggle('active', i===idx));
    const cur = steps[idx] || {name:'Done', note:'', tag:'—'};
    $('#nowTag').textContent = cur.tag || '—';
    $('#nowStep').textContent = cur.name || 'Done';
    $('#nowSubtitle').textContent = cur.note || '';
  }
  function updateClock(){
    $('#clock').textContent = fmt(remain);
    $('#scrubber').value = elapsed();
    $('#scrubOut').textContent = fmt(elapsed());
  }
  function tick(){
    if(!ticking) return;
    remain = Math.max(0, remain-1);
    const e = elapsed();
    // find step
    let acc=0, newIdx=0;
    for(let i=0;i<steps.length;i++){ acc += steps[i].dur; if(e < acc){ newIdx = i; break; } }
    if(newIdx!==idx){ idx=newIdx; highlight(); updateFooterSetInfo(); }
    updateClock();
    if(remain===0){ pause(); $('#nowStep').textContent='Finished • Nice work'; $('#nowSubtitle').textContent='Cool down + hydration'; }
  }
  function start(){
    if(ticking) return;
    if(remain===planTotal()){ idx=0; highlight(); updateFooterSetInfo(); }
    ticking = true; handle = setInterval(tick,1000);
    // optional: navigator.vibrate && navigator.vibrate(10); // haptics hook
  }
  function pause(){ ticking=false; if(handle) clearInterval(handle); }
  function reset(){ pause(); remain = planTotal(); idx=0; updateClock(); highlight(); updateFooterSetInfo(); $('#scrubber').value=0; $('#scrubOut').textContent='00:00'; }

  // Footer slider controls the actual countdown (scrub)
  $('#scrubber').addEventListener('input', (e)=>{
    const newElapsed = Number(e.target.value);
    setElapsed(newElapsed);
  });

  // Buttons
  $('#startBtn').addEventListener('click', start);
  $('#pauseBtn').addEventListener('click', pause);
  $('#resetBtn').addEventListener('click', reset);

  // ---------- Footer Sets/Reps logic ----------
  function updateFooterSetInfo(){
    const fsW = calcFSWeights();
    const cur = steps[idx] || {};
    let text = 'Sets/Reps: —';
    if(cur.id==='s1'||cur.id==='s2'){
      const which = (cur.id==='s1')?1:2;
      const weight = fsW.length ? `${fsW[0].total} ${unitsSymbol()}` : '~70% 1RM';
      text = `Front Squat • Set ${which}/4 • 6 reps @ ${weight}`;
    } else if(cur.id==='s3'||cur.id==='s4'){
      const which = (cur.id==='s3')?3:4;
      const weight = fsW.length ? `${fsW[2].total} ${unitsSymbol()}` : '~75% 1RM';
      text = `Front Squat • Set ${which}/4 • 6 reps @ ${weight}`;
    } else if(cur.tag==='Accessories'){
      text = 'Accessories • Pick 2: RDL 3×10 • Step-Ups 2×10/leg • Bridges 3×12';
    } else if(cur.tag==='Warmup'){
      text = 'Warmup • Knee-friendly prep for squats';
    } else if(cur.tag==='Rest'){
      text = 'Rest • 2:00 (brace, elbows high next set)';
    }
    $('#nowSets').textContent = text;
  }

  // ---------- Save / Load / Events ----------
  function saveState(){
    const d = {
      units:inputs.units.value, bar:inputs.bar.value, oneRM:inputs.oneRM.value,
      fsLow:inputs.fsLow.value, fsHigh:inputs.fsHigh.value, roundTo:inputs.roundTo.value,
      rdlPct:inputs.rdlPct.value, stepPct:inputs.stepPct.value, bridgePct:inputs.bridgePct.value,
      totalMinutes: $('#totalTime').value
    };
    localStorage.setItem('leg30_inputs', JSON.stringify(d));
  }
  function loadState(){
    const raw = localStorage.getItem('leg30_inputs');
    if(!raw){ inputs.units.value='lb'; inputs.bar.value=45; return; }
    try{
      const d = JSON.parse(raw);
      inputs.units.value = d.units ?? 'lb';
      inputs.bar.value   = d.bar ?? 45;
      inputs.oneRM.value = d.oneRM ?? '';
      inputs.fsLow.value = d.fsLow ?? 70;
      inputs.fsHigh.value= d.fsHigh ?? 75;
      inputs.roundTo.value = d.roundTo ?? (inputs.units.value==='kg'?2.5:5);
      inputs.rdlPct.value = d.rdlPct ?? 55;
      inputs.stepPct.value= d.stepPct ?? 30;
      inputs.bridgePct.value = d.bridgePct ?? 60;
      if(d.totalMinutes){ $('#totalTime').value = d.totalMinutes; $('#totalTimeOut').textContent = d.totalMinutes; }
    }catch(e){}
  }

  ['units','barWeight','oneRM','fsLow','fsHigh','roundTo','rdlPct','stepPct','bridgePct']
    .forEach(id=> document.getElementById(id).addEventListener('change', ()=>{ renderTables(); renderPlan(); saveState(); updateFooterSetInfo(); }));

  $('#calc').addEventListener('click', ()=>{ renderTables(); renderPlan(); saveState(); updateFooterSetInfo(); });
  $('#save').addEventListener('click', ()=>{ saveState(); toast('Inputs saved'); });
  $('#clear').addEventListener('click', ()=>{
    localStorage.removeItem('leg30_inputs');
    Object.values(inputs).forEach(el=>{ if(el.tagName==='SELECT'){ el.selectedIndex=0; } else { el.value=''; }});
    inputs.bar.value = (inputs.units.value==='kg')?20:45;
    inputs.roundTo.value = (inputs.units.value==='kg')?2.5:5;
    renderTables(); renderPlan(); updateFooterSetInfo();
  });

  // Total time slider scales plan & resets clock
  const tt = $('#totalTime'), tto = $('#totalTimeOut');
  tt.addEventListener('input', ()=> tto.textContent = tt.value);
  tt.addEventListener('change', ()=>{ scaleToTotal(Number(tt.value)); saveState(); });

  // Focus mode hides extra panels, keeps flow + footer
  $('#focusMode').addEventListener('change', (e)=>{
    const on = e.target.value==='on';
    ['settings','targets','accessories'].forEach(id=>{
      const el = document.getElementById(id); if(el) el.style.display = on ? 'none' : '';
    });
    document.querySelectorAll('.card').forEach(c=> c.style.display = on ? 'none' : '');
  });

  // ---------- Toast ----------
  function toast(msg){
    const t = document.createElement('div');
    t.textContent = msg;
    t.style.position='fixed'; t.style.left='50%'; t.style.bottom='120px';
    t.style.transform='translateX(-50%)'; t.style.padding='10px 14px';
    t.style.background='#0f1530'; t.style.border='1px solid #213059';
    t.style.borderRadius:'999px'; t.style.fontSize:'13px'; t.style.zIndex:'9999';
    t.style.boxShadow='0 8px 24px rgba(0,0,0,.35)';
    document.body.appendChild(t); setTimeout(()=>t.remove(),1400);
  }

  // ---------- Init ----------
  loadState();
  if(!inputs.bar.value){ inputs.bar.value = (inputs.units.value==='kg')?20:45; }
  if(!inputs.roundTo.value){ inputs.roundTo.value = (inputs.units.value==='kg')?2.5:5; }
  renderTables();
  scaleToTotal(Number($('#totalTime').value)); // builds plan and reset timer
  // set initial scrubber labels
  $('#scrubber').value = 0;
  $('#scrubOut').textContent = '00:00';

</script>
</body>
</html>
