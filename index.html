<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>30-Minute Leg Builder (Front Squat Focus)</title>
<style>
  :root{ --pad:14px; --radius:14px; }
  *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  body{ margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
        background:#0e0f12; color:#f5f7fb; line-height:1.45; padding-bottom:96px; }
  header{ padding:20px var(--pad) 8px; border-bottom:1px solid #23252b;
          background:linear-gradient(180deg,#12131a,#0e0f12); position:sticky; top:0; z-index:10; }
  h1{font-size:20px; margin:0 0 6px 0}
  .sub{color:#9aa3b2; font-size:13px}
  .card{ background:#151821; border:1px solid #23252b; border-radius:var(--radius);
         padding:16px; margin:14px; }
  .row{display:flex; gap:10px; flex-wrap:wrap}
  .row > *{flex:1 1 140px}
  label{display:block; font-size:12px; color:#aab1be; margin-bottom:6px}
  input, select{ width:100%; padding:12px; border-radius:12px; border:1px solid #2a2e38;
                 background:#0f1118; color:#eef1f7; font-size:16px; }
  input[type="range"]{ padding:0; }
  input[type="number"]{appearance:textfield}
  input::placeholder{color:#596173}
  .btn{ display:inline-block; width:100%; text-align:center; padding:14px 16px;
        border-radius:14px; border:1px solid #2b2f39; background:#1a1f2b; color:#fff;
        font-weight:600; font-size:16px; }
  .btn:active{transform:scale(0.995)}
  .btn.primary{background:#2563eb; border-color:#2563eb}
  .btn.ghost{background:transparent}
  .btn-row{display:flex; gap:10px; margin-top:8px}
  .section-title{font-weight:700; margin:4px 14px 8px; font-size:15px; color:#cbd5e1}
  .plan{margin:8px 14px}
  .step{ display:flex; align-items:center; gap:10px; padding:12px; border-radius:14px;
         border:1px solid #252a35; margin-bottom:10px; background:#121520; }
  .step.active{border-color:#2563eb; background:#0f1422}
  .step small{color:#92a0b2; font-size:12px}
  .badge{ font-size:12px; padding:4px 8px; border-radius:999px; background:#1f2a3b; color:#cfe0ff; }
  .mono{font-family: ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
  table{width:100%; border-collapse:separate; border-spacing:0 8px}
  td,th{padding:10px 12px; text-align:left; font-size:14px}
  tbody tr{background:#11151f; border:1px solid #242a36}
  tbody tr td:first-child, thead tr th:first-child{border-radius:12px 0 0 12px}
  tbody tr td:last-child, thead tr th:last-child{border-radius:0 12px 12px 0}
  .hint{color:#98a4b8; font-size:13px; margin-top:8px}
  footer{ position:fixed; left:0; right:0; bottom:0; z-index:20;
          background:#0b0d13; border-top:1px solid #1e2230; padding:10px var(--pad);
          display:flex; align-items:center; gap:12px; }
  .now{flex:1}
  .now strong{display:block; font-size:14px}
  .now small{color:#9aa3b2}
  .timer{ min-width:92px; text-align:center; font-weight:800; font-size:18px; letter-spacing:0.5px;
          padding:10px 12px; border-radius:12px; background:#111827; border:1px solid #1f2937; }
  .controls{display:flex; gap:8px}
  .controls .btn{width:auto; padding:10px 12px; font-size:14px}
  .pill{ display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px;
         background:#152033; border:1px solid #22314d; font-size:12px; color:#cfe0ff; }
  .small{font-size:12px; color:#9aa3b2}
  .kicker{color:#a5b4cf; font-size:13px}
  .sliderWrap{display:flex; align-items:center; gap:10px}
  .sliderWrap output{min-width:3ch; text-align:right}
</style>
</head>
<body>
<header>
  <h1>Leg Day • Front Squat Builder</h1>
  <div class="sub">Active knee-friendly warmup → 4×6 front squats @ 70–75% → accessories</div>
</header>

<!-- TOTAL TIME SLIDER -->
<div class="card">
  <div class="section-title">Total Workout Time</div>
  <div class="sliderWrap">
    <input id="totalTime" type="range" min="20" max="45" step="1" value="30" />
    <output id="totalTimeOut" class="mono">30</output><span class="small">min</span>
  </div>
  <div class="hint">All step durations scale to fit this total time while keeping the warmup/squat/accessory ratio.</div>
</div>

<!-- SETTINGS / INPUTS -->
<div class="card" id="settings">
  <div class="section-title">Inputs</div>
  <div class="row">
    <div>
      <label for="units">Units</label>
      <select id="units">
        <option value="lb">Pounds (lb)</option>
        <option value="kg">Kilograms (kg)</option>
      </select>
    </div>
    <div>
      <label for="barWeight">Bar Weight</label>
      <input id="barWeight" type="number" step="1" placeholder="45 (lb) / 20 (kg)" />
    </div>
    <div>
      <label for="oneRM">Front Squat 1RM / Training Max</label>
      <input id="oneRM" type="number" step="1" placeholder="Enter your 1RM or TM" />
    </div>
  </div>
  <div class="row">
    <div>
      <label for="fsLow">Front Squat % (Set 1–2)</label>
      <input id="fsLow" type="number" step="1" value="70" />
      <div class="small">Default 70%</div>
    </div>
    <div>
      <label for="fsHigh">Front Squat % (Set 3–4)</label>
      <input id="fsHigh" type="number" step="1" value="75" />
      <div class="small">Default 75%</div>
    </div>
    <div>
      <label for="roundTo">Round to nearest</label>
      <input id="roundTo" type="number" step="0.5" value="5" />
      <div class="small">Use 2.5 for kg plates</div>
    </div>
  </div>

  <div class="row">
    <div>
      <label for="rdlPct">RDL % of Front Squat 1RM</label>
      <input id="rdlPct" type="number" step="1" value="55" />
      <div class="small">3×10 (edit if needed)</div>
    </div>
    <div>
      <label for="stepPct">Step-Ups % of Front Squat 1RM (pair total)</label>
      <input id="stepPct" type="number" step="1" value="30" />
      <div class="small">2×10/leg (split into dumbbells)</div>
    </div>
    <div>
      <label for="bridgePct">Glute Bridge % of Front Squat 1RM</label>
      <input id="bridgePct" type="number" step="1" value="60" />
      <div class="small">3×12</div>
    </div>
  </div>

  <div class="btn-row">
    <button class="btn" id="save">Save Inputs</button>
    <button class="btn ghost" id="clear">Clear</button>
    <button class="btn primary" id="calc">Calculate Weights</button>
  </div>
  <div class="hint">Tip: enter your Training Max if you prefer (e.g., 90% of true 1RM). The plan will calculate and round all working weights.</div>
</div>

<!-- SQUAT TARGETS -->
<div class="card" id="targets">
  <div class="section-title">Front Squat Targets (4×6 • 3s down, fast up)</div>
  <table>
    <thead>
      <tr>
        <th>Set</th><th>%</th><th>Target (Total)</th><th>Plates/Side</th><th>Notes</th>
      </tr>
    </thead>
    <tbody id="fsTable"></tbody>
  </table>
  <div class="hint kicker">Aim for tall torso, elbows high. Rest as the timer dictates.</div>
</div>

<!-- ACCESSORY TARGETS -->
<div class="card" id="accessories">
  <div class="section-title">Accessory Suggestions (adjust % above as needed)</div>
  <table>
    <thead><tr><th>Exercise</th><th>Sets×Reps</th><th>Suggested Load</th><th>Notes</th></tr></thead>
    <tbody id="accTable"></tbody>
  </table>
</div>

<!-- WORKOUT FLOW / TIMER -->
<div class="section-title">Guided Flow</div>
<div class="plan" id="plan"></div>

<footer>
  <div class="now">
    <strong id="nowStep">Ready • Press Start</strong>
    <small id="nowSubtitle">Warmup begins at 00:00</small>
  </div>
  <div class="timer mono" id="clock">30:00</div>
  <div class="controls">
    <button class="btn primary" id="startBtn">Start</button>
    <button class="btn" id="pauseBtn">Pause</button>
    <button class="btn ghost" id="resetBtn">Reset</button>
  </div>
</footer>

<script>
  // ---------- Shortcuts ----------
  const $ = s => document.querySelector(s);
  const inputs = {
    units: $('#units'), bar: $('#barWeight'), oneRM: $('#oneRM'),
    fsLow: $('#fsLow'), fsHigh: $('#fsHigh'), roundTo: $('#roundTo'),
    rdlPct: $('#rdlPct'), stepPct: $('#stepPct'), bridgePct: $('#bridgePct')
  };

  // ---------- Duration Model with Scaling ----------
  // Base 30:00 = 1800s (10 warmup / 15 squat / 5 accessories)
  const baseSteps = [
    // Warmup (600s total)
    {id:'w1', tag:'Warmup',       name:'Foam Roll Quads & Glutes', dur:60,  note:'30s each side'},
    {id:'w2', tag:'Warmup',       name:'Leg Swings',               dur:60,  note:'20 F/B + 20 S/S each leg'},
    {id:'w3', tag:'Warmup',       name:'Glute Bridges',            dur:60,  note:'2×15 (bodyweight)'},
    {id:'w4', tag:'Warmup',       name:'Walking Lunges',           dur:120, note:'2×12 each (short stride)'},
    {id:'w5', tag:'Warmup',       name:'Banded Lateral Walks',     dur:120, note:'2×10 steps each direction'},
    {id:'w6', tag:'Warmup',       name:'Goblet Squat Hold',        dur:180, note:'30s hold × 2, pry hips open'},

    // Squat block (900s total target)
    {id:'s0', tag:'Front Squat',  name:'Setup & Bracing',          dur:120, note:'Rack height, breathe, elbows under'},
    {id:'s1', tag:'Front Squat',  name:'Front Squat – Set 1',      dur:75,  note:'6 reps @ Set 1 %'},
    {id:'r1', tag:'Rest',         name:'Rest',                     dur:150, note:'Breathe; elbows high next set'},
    {id:'s2', tag:'Front Squat',  name:'Front Squat – Set 2',      dur:75,  note:'6 reps @ Set 1 %'},
    {id:'r2', tag:'Rest',         name:'Rest',                     dur:150, note:'Brace hard; knees track out'},
    {id:'s3', tag:'Front Squat',  name:'Front Squat – Set 3',      dur:75,  note:'6 reps @ Set 3 %'},
    {id:'r3', tag:'Rest',         name:'Rest',                     dur:150, note:'Stay upright; heels down'},
    {id:'s4', tag:'Front Squat',  name:'Front Squat – Set 4',      dur:75,  note:'6 reps @ Set 3 %'},
    {id:'sx', tag:'Front Squat',  name:'Reset & Notes',            dur:30,  note:'Log weight, loosen wrists'},

    // Accessories (300s target)
    {id:'a1', tag:'Accessories',  name:'Accessories',              dur:300, note:'Pick 2—RDL / Step-Ups / Bridges'},
  ];

  function baseTotal(){ return baseSteps.reduce((s,x)=>s+x.dur,0); } // 1800
  let steps = JSON.parse(JSON.stringify(baseSteps)); // working copy

  function scaleToTotal(minutes){
    const target = minutes * 60;
    const base = baseTotal();
    const scale = target / base;

    // scale each step; keep a floor so nothing vanishes
    let sum = 0;
    steps = baseSteps.map(st=>{
      const scaled = Math.max(30, Math.round(st.dur * scale)); // 30s min per step
      sum += scaled; return {...st, dur:scaled};
    });

    // Fix rounding drift by adjusting the last step
    const diff = target - sum;
    steps[steps.length-1].dur += diff;

    renderPlan();
    reset(); // reset timer to new total
  }

  // ---------- Save / Load ----------
  function unitsSymbol(){ return inputs.units.value === 'kg' ? 'kg' : 'lb'; }
  function roundToNearest(value, step){ const s = Number(step||5); return Math.round(value/s)*s; }
  function plateMath(total, bar, step){
    const perSide = (total - bar) / 2; if(perSide<=0) return '—';
    const p = roundToNearest(perSide, step); return `${p}${unitsSymbol()}`;
  }
  function saveInputs(){
    const d = {
      units:inputs.units.value, bar:inputs.bar.value, oneRM:inputs.oneRM.value,
      fsLow:inputs.fsLow.value, fsHigh:inputs.fsHigh.value, roundTo:inputs.roundTo.value,
      rdlPct:inputs.rdlPct.value, stepPct:inputs.stepPct.value, bridgePct:inputs.bridgePct.value,
      totalMinutes: $('#totalTime').value
    };
    localStorage.setItem('leg30_inputs', JSON.stringify(d));
  }
  function loadInputs(){
    const raw = localStorage.getItem('leg30_inputs');
    if(!raw){ inputs.units.value='lb'; inputs.bar.value=45; return; }
    try{
      const d = JSON.parse(raw);
      inputs.units.value = d.units ?? 'lb';
      inputs.bar.value   = d.bar ?? 45;
      inputs.oneRM.value = d.oneRM ?? '';
      inputs.fsLow.value = d.fsLow ?? 70;
      inputs.fsHigh.value= d.fsHigh ?? 75;
      inputs.roundTo.value = d.roundTo ?? (inputs.units.value==='kg'?2.5:5);
      inputs.rdlPct.value = d.rdlPct ?? 55;
      inputs.stepPct.value= d.stepPct ?? 30;
      inputs.bridgePct.value = d.bridgePct ?? 60;
      if(d.totalMinutes){ $('#totalTime').value = d.totalMinutes; }
    }catch(e){}
  }

  // ---------- Weights ----------
  function calcFSWeights(){
    const rm = Number(inputs.oneRM.value || 0);
    const bar = Number(inputs.bar.value || 0);
    const r = Number(inputs.roundTo.value || 5);
    const low = Number(inputs.fsLow.value || 70)/100;
    const high= Number(inputs.fsHigh.value || 75)/100;
    if (rm<=0 || bar<=0) return [];
    const s1 = roundToNearest(rm*low, r),
          s2 = s1,
          s3 = roundToNearest(rm*high, r),
          s4 = s3;
    return [
      {set:1, pct:Math.round(low*100)+'%', total:s1, plates:plateMath(s1,bar,r)},
      {set:2, pct:Math.round(low*100)+'%', total:s2, plates:plateMath(s2,bar,r)},
      {set:3, pct:Math.round(high*100)+'%', total:s3, plates:plateMath(s3,bar,r)},
      {set:4, pct:Math.round(high*100)+'%', total:s4, plates:plateMath(s4,bar,r)},
    ];
  }
  function calcAccessories(){
    const rm = Number(inputs.oneRM.value || 0);
    const r = Number(inputs.roundTo.value || 5);
    const bar = Number(inputs.bar.value || 0);
    if (rm<=0) return [];
    const rdl = roundToNearest(rm * (Number(inputs.rdlPct.value||55)/100), r);
    const stepPair = roundToNearest(rm * (Number(inputs.stepPct.value||30)/100), r);
    const bridge = roundToNearest(rm * (Number(inputs.bridgePct.value||60)/100), r);
    const stepEach = unitsSymbol()==='kg' ? Math.round((stepPair/2)*10)/10 : roundToNearest(stepPair/2, r);
    return [
      {name:'Romanian Deadlift (RDL)', scheme:'3×10', load:`${rdl}${unitsSymbol()}`, notes:'Barbell or dumbbells'},
      {name:'Weighted Step-Ups', scheme:'2×10/leg', load:`${stepEach}${unitsSymbol()} each hand`, notes:'Box ~ knee height'},
      {name:'Barbell Glute Bridge', scheme:'3×12', load:`${bridge}${unitsSymbol()}`, notes:`Plates/side: ${plateMath(bridge,bar,r)}`}
    ];
  }
  function renderTables(){
    const fsData = calcFSWeights();
    const fsT = $('#fsTable'); fsT.innerHTML='';
    if(!fsData.length){
      fsT.innerHTML = `<tr><td colspan="5" class="small">Enter your 1RM/TM and click <b>Calculate Weights</b>.</td></tr>`;
    } else {
      fsData.forEach(row=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>Set ${row.set}</td>
          <td><span class="badge">${row.pct}</span></td>
          <td class="mono">${row.total} ${unitsSymbol()}</td>
          <td class="mono">${row.plates}</td>
          <td>${row.set<=2?'Focus depth & bracing':'Drive elbows up, stay tall'}</td>`;
        fsT.appendChild(tr);
      });
    }
    const acc = calcAccessories();
    const accT = $('#accTable'); accT.innerHTML='';
    if(!acc.length){
      accT.innerHTML = `<tr><td colspan="4" class="small">Enter your 1RM/TM to get suggested loads for accessories.</td></tr>`;
    } else {
      acc.forEach(a=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${a.name}</td><td>${a.scheme}</td><td class="mono">${a.load}</td><td>${a.notes}</td>`;
        accT.appendChild(tr);
      });
    }
  }

  // ---------- Plan / Steps / Timer ----------
  const planEl = $('#plan');
  function fmt(s){ const m=Math.floor(s/60),sec=s%60; return `${String(m).padStart(2,'0')}:${String(sec).padStart(2,'0')}`; }
  function totalTime(){ return steps.reduce((s,x)=>s+x.dur,0); }

  function renderPlan(){
    planEl.innerHTML = '';
    const fsW = calcFSWeights();
    steps.forEach(st=>{
      const row = document.createElement('div');
      row.className = 'step';
      const pctHint = (id)=>{
        if(id==='s1'||id==='s2') return fsW.length?`${fsW[0].total} ${unitsSymbol()}`:'~70% 1RM';
        if(id==='s3'||id==='s4') return fsW.length?`${fsW[2].total} ${unitsSymbol()}`:'~75% 1RM';
        return null;
      }
      const add = pctHint(st.id);
      row.innerHTML = `
        <div class="pill">${st.tag}</div>
        <div style="flex:1">
          <div style="font-weight:700">${st.name}${add?` • <span class="mono">${add}</span>`:''}</div>
          <small>${st.note||''}</small>
        </div>
        <div class="mono">${fmt(st.dur)}</div>`;
      planEl.appendChild(row);
    });
    highlight();
    updateClock();
  }

  let idx = 0, remain = 0, ticking = false, handle = null;

  function highlight(){
    document.querySelectorAll('.step').forEach((el,i)=> el.classList.toggle('active', i===idx));
    const cur = steps[idx] || {name:'Done', note:''};
    $('#nowStep').textContent = cur.name || 'Done';
    $('#nowSubtitle').textContent = cur.note || '';
  }
  function updateClock(){ $('#clock').textContent = fmt(remain); }
  function tick(){
    if(!ticking) return;
    remain = Math.max(0, remain-1);
    const elapsed = totalTime() - remain;
    let acc=0, newIdx=0;
    for(let i=0;i<steps.length;i++){ acc+=steps[i].dur; if(elapsed<acc){ newIdx=i; break; } }
    if(newIdx!==idx){ idx=newIdx; highlight(); }
    updateClock();
    if(remain===0){ pause(); $('#nowStep').textContent='Finished • Nice work'; $('#nowSubtitle').textContent='Cool down + hydration'; }
  }
  function start(){
    if(ticking) return;
    if(remain===totalTime()){ idx=0; highlight(); }
    ticking = true; handle = setInterval(tick,1000);
  }
  function pause(){ ticking=false; if(handle) clearInterval(handle); }
  function reset(){ pause(); remain = totalTime(); idx=0; updateClock(); highlight(); }

  $('#startBtn').addEventListener('click', start);
  $('#pauseBtn').addEventListener('click', pause);
  $('#resetBtn').addEventListener('click', reset);

  // ---------- Events ----------
  $('#save').addEventListener('click', ()=>{ saveInputs(); toast('Inputs saved'); });
  $('#clear').addEventListener('click', ()=>{
    localStorage.removeItem('leg30_inputs');
    Object.values(inputs).forEach(el=>{
      if(el.tagName==='SELECT'){ el.selectedIndex=0; } else { el.value=''; }
    });
    inputs.bar.value = (inputs.units.value==='kg')?20:45;
    inputs.roundTo.value = (inputs.units.value==='kg')?2.5:5;
    renderTables(); renderPlan();
  });
  $('#calc').addEventListener('click', ()=>{ saveInputs(); renderTables(); renderPlan(); });

  ['units','barWeight','oneRM','fsLow','fsHigh','roundTo','rdlPct','stepPct','bridgePct']
  .forEach(id=> document.getElementById(id).addEventListener('change', ()=>{ renderTables(); renderPlan(); saveInputs(); }));

  // total time slider
  const slider = $('#totalTime'), out = $('#totalTimeOut');
  slider.addEventListener('input', ()=>{
    out.textContent = slider.value;
  });
  slider.addEventListener('change', ()=>{
    scaleToTotal(Number(slider.value));
    saveInputs();
  });

  // ---------- Toast ----------
  function toast(msg){
    const t = document.createElement('div');
    t.textContent = msg;
    t.style.position='fixed'; t.style.left='50%'; t.style.bottom='110px';
    t.style.transform='translateX(-50%)';
    t.style.padding='10px 14px'; t.style.background='#111827'; t.style.border='1px solid #1f2937';
    t.style.borderRadius='999px'; t.style.fontSize='13px'; t.style.zIndex='9999';
    document.body.appendChild(t); setTimeout(()=>t.remove(),1500);
  }

  // ---------- Init ----------
  loadInputs();
  if(!inputs.bar.value){ inputs.bar.value = (inputs.units.value==='kg')?20:45; }
  if(!inputs.roundTo.value){ inputs.roundTo.value = (inputs.units.value==='kg')?2.5:5; }
  renderTables();
  scaleToTotal(Number($('#totalTime').value)); // builds plan and resets timer
</script>
</body>
</html>
